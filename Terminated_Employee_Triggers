--Trigger to prevent adding an employee with a Terminated manager---
CREATE OR REPLACE TRIGGER prevent_terminated_manager
BEFORE INSERT ON EMPLOYEEP
FOR EACH ROW
DECLARE
    manager_status CHAR(1);
BEGIN
    -- Retrieve the status of the manager
    SELECT EmployeeStatus INTO manager_status
    FROM EMPLOYEEP
    WHERE EmployeeID = :NEW.ManagerID;

    -- Check if the manager is terminated
    IF manager_status = 'T' THEN
        raise_application_error(-20001, 'Cannot assign a manager with EmployeeStatus = ''T''');
    END IF;
END;

--Trigger deletes projects records in WORKSONP if an employee is terminated---
CREATE OR REPLACE TRIGGER Delete_Worksonp_Record
BEFORE UPDATE ON EMPLOYEEP
FOR EACH ROW
BEGIN
    IF :OLD.EmployeeStatus <> 'T' AND :NEW.EmployeeStatus = 'T' THEN
        -- Delete records in WORKSONP for the employee
        DELETE FROM WORKSONP
        WHERE EmployeeID = :NEW.EmployeeID;
    END IF;
END;


------ check if manager procedure ----------
CREATE OR REPLACE PROCEDURE is_employee_manager(
    p_employee_id IN EMPLOYEEP.EmployeeID%TYPE,
    p_result OUT NUMBER
)
IS
BEGIN
    -- Check if the employee is a manager for anyone
    SELECT COUNT(*)
    INTO p_result
    FROM EMPLOYEEP
    WHERE ManagerID = p_employee_id AND EmployeeStatus = 'A';
    DBMS_OUTPUT.PUT_LINE(p_result);
    -- Set the result based on the count
END is_employee_manager;
/

