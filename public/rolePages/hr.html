<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HR Portal</title>
  <link rel="stylesheet" href="../stylesheets/hr.css">
</head>
<body>
  <div class="container">
    <h1>HR Portal</h1>

    <form class="addEmployeeForm" id="addEmployeeForm">
      <div class="form-row">
        <div class="form-group">
          <label for="EmployeeID">Employee ID:</label>
          <input type="text" id="EmployeeID" required>
        </div>
        <div class="form-group">
          <label for="F_Name">First Name:</label>
          <input type="text" id="F_Name" required>
        </div>
        <div class="form-group">
          <label for="L_Name">Last Name:</label>
          <input type="text" id="L_Name" required>
        </div>
        <div class="form-group">
          <label for="B_Date">Birth Date:</label>
          <input type="text" id="B_Date">
        </div>
        <div class="form-group">
          <label for="Address">Address:</label>
          <input type="text" id="Address" required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="Email">Email:</label>
          <input type="text" id="Email">
        </div>
        <div class="form-group">
          <label for="DepartmentID">Department ID:</label>
          <input type="text" id="DepartmentID">
        </div>
        <div class="form-group">
          <label for="Position">Position:</label>
          <input type="text" id="Position" required>
        </div>
        <div class="form-group">
          <label for="Wage">Wage:</label>
          <input type="text" id="Wage" required>
        </div>
        <div class="form-group">
          <label for="ManagerID">Manager ID:</label>
          <input type="text" id="ManagerID" required>
        </div>
      </div>
      <button type="submit">Add Employee</button>
    </form>
    
    <table id="employeeTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th>
          <th>Department ID</th>
          <th>Position</th>
          <th>Wage</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="employeeData"></tbody>
    </table>
  </div>

  <script>
    function fetchAndPopulateData() {
        fetch('/employees')
            .then(response => response.json())
            .then(data => {
                const employeeData = document.getElementById('employeeData');
                employeeData.innerHTML = '';

                data.forEach(employee => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${employee[0]}</td>
                        <td>${employee[1]}</td>
                        <td>${employee[2]}</td>
                        <td>${employee[5]}</td>
                        <td>${employee[6]}</td>
                        <td>${employee[7]}</td>
                        <td>${employee[8]}</td>
                        <td>
                            <button class="deleteBtn" onclick="deleteEmployee(${employee[0]})">Delete</button>
                        </td>
                    `;
                    employeeData.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    fetchAndPopulateData();

    function deleteEmployee(employeeID) {
        fetch('/deleteEmployee', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ employeeID }),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            fetchAndPopulateData();
        })
        .catch(error => console.error('Error deleting employee:', error));
    }

    document.getElementById('addEmployeeForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const formData = {
            EmployeeID: document.getElementById('EmployeeID').value,
            F_Name: document.getElementById('F_Name').value,
            L_Name: document.getElementById('L_Name').value,
            B_Date: document.getElementById('B_Date').value,
            Address: document.getElementById('Address').value,
            Email: document.getElementById('Email').value,
            DepartmentID: document.getElementById('DepartmentID').value,
            Position_1: document.getElementById('Position').value,
            Wage: document.getElementById('Wage').value,
            ManagerID: document.getElementById('ManagerID').value,
        };

        fetch('/insertEmployee', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            fetchAndPopulateData();
        })
        .catch(error => console.error('Error adding employee:', error));
    });
  </script>
</body>
</html>
