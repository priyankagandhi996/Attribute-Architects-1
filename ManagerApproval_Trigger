---Trigger Checks if TimeSheet is approved before creating PayStub record---
CREATE OR REPLACE TRIGGER Manager_Approval
BEFORE INSERT ON PayStub
FOR EACH ROW
DECLARE p_M_Approval VARCHAR(1);
BEGIN

    SELECT M_Approval INTO p_M_Approval
    FROM TIMESHEET
    WHERE TimeSheetID= :new.TimeSheetID;
    
    IF p_M_Approval = 'N'
    THEN RAISE_APPLICATION_ERROR(-20001, 'The timesheet has not been approved.');
    END IF;
END;

---Trigger does not Allow us to Update Timesheet record if already approved---

CREATE OR REPLACE TRIGGER Manager_Approval_Update
BEFORE UPDATE ON TimeSheet
FOR EACH ROW
BEGIN
    
    IF :OLD.M_Approval = 'Y'
    THEN RAISE_APPLICATION_ERROR(-20001, 'The timesheet has already been approved.');
    END IF;
END;
