--Payroll Summary Procedure--
create or replace PROCEDURE Calc_PayrollSummary(
    p_PayPeriod DATE,
    p_EmployeeCount OUT NUMBER,
    p_GrossPaySum OUT NUMBER,
    p_DeductionsSum OUT NUMBER,
    p_NetPaySum OUT NUMBER
)
IS
BEGIN
    SELECT COUNT(DISTINCT t.EmployeeID),
           SUM(ps.GrossPay),
           SUM(ps.Deductions),
           SUM(ps.NetPay)
    INTO p_EmployeeCount, p_GrossPaySum, p_DeductionsSum, p_NetPaySum
    FROM TIMESHEET t
    INNER JOIN PAYSTUB ps ON t.TimeSheetID = ps.TimeSheetID
    WHERE t.PayPeriod = p_PayPeriod;

    DBMS_OUTPUT.PUT_LINE('Number of Employees with Paystubs: ' || p_EmployeeCount);
    DBMS_OUTPUT.PUT_LINE('Total Gross Pay: ' || p_GrossPaySum);
    DBMS_OUTPUT.PUT_LINE('Total Deductions: ' || p_DeductionsSum);
    DBMS_OUTPUT.PUT_LINE('Total Net Pay: ' || p_NetPaySum);

END Calc_PayrollSummary;

--Testing Procedure--

set serveroutput on;
DECLARE
    v_PayPeriod DATE := DATE '2023-09-01';
    v_EmployeeCount NUMBER;
    v_GrossPaySum NUMBER;
    v_DeductionsSum NUMBER;
    v_NetPaySum NUMBER;
BEGIN
    Calc_PayrollSummary(v_PayPeriod, v_EmployeeCount, v_GrossPaySum, v_DeductionsSum, v_NetPaySum);
END;
